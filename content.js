// Add toast notification function at the top level
function showToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        background: #092540;
        color: white;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        z-index: 999999999;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        box-shadow: 0px 4px 8px rgba(9, 37, 64, 0.08);
    `;
    toast.textContent = message;
    document.body.appendChild(toast);

    // Trigger fade in
    setTimeout(() => {
        toast.style.opacity = '1';
    }, 10);

    // Remove after 2 seconds
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 200);
    }, 2000);
}

function getASIN() {
    // Try to get ASIN from URL first
    const urlMatch = window.location.pathname.match(/\/dp\/([A-Z0-9]{10})/);
    if (urlMatch) {
        return urlMatch[1];
    }
    
    // Fallback to looking for ASIN in the page data
    const element = document.querySelector('[data-asin]');
    return element ? element.getAttribute('data-asin') : null;
}

function getProductTitle() {
    return document.getElementById('productTitle')?.textContent.trim() || '';
}

function isProductPage() {
    return window.location.pathname.includes('/dp/') || 
           window.location.pathname.includes('/gp/product/');
}

function getAmazonDomain() {
    // Remove 'www.' prefix if it exists
    return window.location.hostname.replace('www.', '');
}

function getLastTwelveMonthsRange() {
    const end = new Date();
    const start = new Date();
    start.setMonth(end.getMonth() - 11);  // Go back 11 months for a 12-month range
    
    // Format as YYYY-MM
    const endStr = `${end.getFullYear()}-${String(end.getMonth() + 1).padStart(2, '0')}`;
    const startStr = `${start.getFullYear()}-${String(start.getMonth() + 1).padStart(2, '0')}`;
    
    return { start: startStr, end: endStr };
}

function getParentASIN() {
    // Try to get parent ASIN from various locations
    
    // Method 1: Check for parent ASIN in variation selector
    const variationElement = document.querySelector('#variation_pattern');
    if (variationElement) {
        const parentAsinMatch = variationElement.innerHTML.match(/parentAsin=([A-Z0-9]{10})/);
        if (parentAsinMatch) return parentAsinMatch[1];
    }

    // Method 2: Check for parent ASIN in URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const parentAsinFromURL = urlParams.get('th');
    if (parentAsinFromURL && parentAsinFromURL.match(/^[A-Z0-9]{10}$/)) {
        return parentAsinFromURL;
    }

    // Method 3: Look for parent ASIN in page data
    const dataElements = document.querySelectorAll('[data-parent-asin]');
    for (const element of dataElements) {
        const parentAsin = element.getAttribute('data-parent-asin');
        if (parentAsin && parentAsin.match(/^[A-Z0-9]{10}$/)) {
            return parentAsin;
        }
    }

    // Fallback to regular ASIN if parent not found
    return getASIN();
}

function getBrand() {
    // Try different selectors for brand information
    const brandSelectors = [
        '#bylineInfo',
        '#brand',
        '#productDetails_techSpec_section_1 tr:has(th:contains("Brand")) td',
        '#productDetails_detailBullets_sections1 tr:has(th:contains("Brand")) td'
    ];
    
    for (const selector of brandSelectors) {
        const element = document.querySelector(selector);
        if (element) {
            return element.textContent.trim().replace('Brand: ', '').replace('Visit the ', '').replace(' Store', '');
        }
    }
    return 'N/A';
}

function getCategory() {
    // Method 1: Try to get category from bestseller rank element with zg_hrsr class
    const bestsellerElement = document.querySelector('.zg_hrsr');
    if (bestsellerElement) {
        const categoryLink = bestsellerElement.querySelector('a');
        if (categoryLink) {
            return categoryLink.textContent.trim();
        }
    }

    // Method 2: Try to get from product details table
    const rankCell = document.querySelector('td:has(span a[href*="/gp/bestsellers/"])');
    if (rankCell) {
        // Get all category spans that contain links
        const categorySpans = rankCell.querySelectorAll('span:has(a[href*="/gp/bestsellers/"])');
        if (categorySpans.length > 0) {
            // Get the last category span (most specific)
            const lastSpan = categorySpans[categorySpans.length - 1];
            const categoryLink = lastSpan.querySelector('a');
            if (categoryLink) {
                return categoryLink.textContent.trim();
            }
        }
    }

    return 'N/A';
}

function getShopperLogo() {
    return `
        <div style="display: flex; align-items: center;">
            <div style="display: flex; align-items: center; height: 24px;">
                <svg width="190" height="18" viewBox="0 0 190 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M123.582 11.1984C123.022 11.1984 122.525 11.0789 122.092 10.84C121.659 10.6011 121.319 10.2651 121.073 9.832C120.826 9.39893 120.703 8.89867 120.703 8.3312C120.703 7.75627 120.823 7.2448 121.062 6.7968C121.308 6.3488 121.644 6.0016 122.07 5.7552C122.503 5.50133 123.01 5.3744 123.593 5.3744C124.138 5.3744 124.619 5.49387 125.038 5.7328C125.456 5.97173 125.78 6.30027 126.012 6.7184C126.251 7.12907 126.37 7.58827 126.37 8.096C126.37 8.17813 126.367 8.264 126.359 8.3536C126.359 8.4432 126.355 8.53653 126.348 8.6336H122.126C122.155 9.06667 122.305 9.4064 122.574 9.6528C122.85 9.8992 123.182 10.0224 123.57 10.0224C123.862 10.0224 124.104 9.95893 124.298 9.832C124.5 9.6976 124.649 9.52587 124.746 9.3168H126.202C126.098 9.66773 125.922 9.9888 125.676 10.28C125.437 10.5637 125.138 10.7877 124.78 10.952C124.429 11.1163 124.03 11.1984 123.582 11.1984ZM123.593 6.5392C123.242 6.5392 122.932 6.64 122.663 6.8416C122.394 7.03573 122.223 7.3344 122.148 7.7376H124.914C124.892 7.37173 124.758 7.08053 124.511 6.864C124.265 6.64747 123.959 6.5392 123.593 6.5392Z" fill="#092540"/>
                    <path d="M117.112 11.1984C116.544 11.1984 116.044 11.0752 115.611 10.8288C115.178 10.5824 114.834 10.2389 114.581 9.7984C114.334 9.35787 114.211 8.85387 114.211 8.2864C114.211 7.71893 114.334 7.21493 114.581 6.7744C114.834 6.33387 115.178 5.9904 115.611 5.744C116.044 5.4976 116.544 5.3744 117.112 5.3744C117.821 5.3744 118.418 5.56107 118.904 5.9344C119.389 6.30027 119.699 6.808 119.833 7.4576H118.321C118.247 7.1888 118.097 6.97973 117.873 6.8304C117.657 6.6736 117.399 6.5952 117.101 6.5952C116.705 6.5952 116.369 6.74453 116.093 7.0432C115.816 7.34187 115.678 7.75627 115.678 8.2864C115.678 8.81653 115.816 9.23093 116.093 9.5296C116.369 9.82827 116.705 9.9776 117.101 9.9776C117.399 9.9776 117.657 9.90293 117.873 9.7536C118.097 9.60427 118.247 9.39147 118.321 9.1152H119.833C119.699 9.7424 119.389 10.2464 118.904 10.6272C118.418 11.008 117.821 11.1984 117.112 11.1984Z" fill="#092540"/>
                    <path d="M107.801 11.064V5.5088H109.066L109.178 6.4496C109.35 6.12107 109.597 5.85973 109.918 5.6656C110.246 5.47147 110.631 5.3744 111.071 5.3744C111.758 5.3744 112.292 5.59093 112.673 6.024C113.054 6.45707 113.244 7.09173 113.244 7.928V11.064H111.81V8.0624C111.81 7.58453 111.713 7.21867 111.519 6.9648C111.325 6.71093 111.023 6.584 110.612 6.584C110.209 6.584 109.877 6.72587 109.615 7.0096C109.361 7.29333 109.234 7.68907 109.234 8.1968V11.064H107.801Z" fill="#092540"/>
                    <path d="M104.03 11.1984C103.47 11.1984 102.973 11.0789 102.54 10.84C102.107 10.6011 101.767 10.2651 101.521 9.832C101.275 9.39893 101.151 8.89867 101.151 8.3312C101.151 7.75627 101.271 7.2448 101.51 6.7968C101.756 6.3488 102.092 6.0016 102.518 5.7552C102.951 5.50133 103.459 5.3744 104.041 5.3744C104.586 5.3744 105.068 5.49387 105.486 5.7328C105.904 5.97173 106.229 6.30027 106.46 6.7184C106.699 7.12907 106.819 7.58827 106.819 8.096C106.819 8.17813 106.815 8.264 106.807 8.3536C106.807 8.4432 106.804 8.53653 106.796 8.6336H102.574C102.604 9.06667 102.753 9.4064 103.022 9.6528C103.298 9.8992 103.63 10.0224 104.019 10.0224C104.31 10.0224 104.552 9.95893 104.747 9.832C104.948 9.6976 105.098 9.52587 105.195 9.3168H106.651C106.546 9.66773 106.371 9.9888 106.124 10.28C105.885 10.5637 105.587 10.7877 105.228 10.952C104.877 11.1163 104.478 11.1984 104.03 11.1984ZM104.041 6.5392C103.69 6.5392 103.38 6.64 103.111 6.8416C102.843 7.03573 102.671 7.3344 102.596 7.7376H105.363C105.34 7.37173 105.206 7.08053 104.959 6.864C104.713 6.64747 104.407 6.5392 104.041 6.5392Z" fill="#092540"/>
                    <path d="M97.7491 9.4064C97.4803 9.4064 97.2302 9.37653 96.9987 9.3168L96.5843 9.7312C96.7113 9.7984 96.883 9.8544 97.0995 9.8992C97.3161 9.944 97.667 9.9888 98.1523 10.0336C98.8915 10.1008 99.4291 10.2763 99.7651 10.56C100.101 10.8437 100.269 11.2357 100.269 11.736C100.269 12.0645 100.18 12.3744 100 12.6656C99.8211 12.9643 99.5449 13.2032 99.1715 13.3824C98.7982 13.5691 98.3203 13.6624 97.7379 13.6624C96.9465 13.6624 96.3081 13.5131 95.8227 13.2144C95.3374 12.9232 95.0947 12.4827 95.0947 11.8928C95.0947 11.3925 95.3374 10.9595 95.8227 10.5936C95.6734 10.5264 95.5427 10.4555 95.4307 10.3808C95.3262 10.3061 95.2329 10.2277 95.1507 10.1456V9.888L96.1251 8.8576C95.6921 8.4768 95.4755 7.98773 95.4755 7.3904C95.4755 7.01707 95.5651 6.67733 95.7443 6.3712C95.931 6.06507 96.1923 5.8224 96.5283 5.6432C96.8643 5.464 97.2713 5.3744 97.7491 5.3744C98.0627 5.3744 98.3539 5.4192 98.6227 5.5088H100.728V6.3824L99.7763 6.4496C99.9257 6.73333 100 7.04693 100 7.3904C100 7.76373 99.9107 8.10347 99.7315 8.4096C99.5523 8.71573 99.291 8.9584 98.9475 9.1376C98.6115 9.3168 98.2121 9.4064 97.7491 9.4064ZM97.7491 8.3088C98.0403 8.3088 98.2793 8.2304 98.4659 8.0736C98.6601 7.9168 98.7571 7.6928 98.7571 7.4016C98.7571 7.1104 98.6601 6.8864 98.4659 6.7296C98.2793 6.5728 98.0403 6.4944 97.7491 6.4944C97.443 6.4944 97.1966 6.5728 97.0099 6.7296C96.8233 6.8864 96.7299 7.1104 96.7299 7.4016C96.7299 7.6928 96.8233 7.9168 97.0099 8.0736C97.1966 8.2304 97.443 8.3088 97.7491 8.3088ZM96.4051 11.7472C96.4051 12.0235 96.5321 12.2288 96.7859 12.3632C97.0473 12.5051 97.3646 12.576 97.7379 12.576C98.0963 12.576 98.3875 12.5013 98.6115 12.352C98.8355 12.2101 98.9475 12.016 98.9475 11.7696C98.9475 11.568 98.8729 11.4 98.7235 11.2656C98.5817 11.1312 98.2942 11.0491 97.8611 11.0192C97.555 10.9968 97.2713 10.9632 97.0099 10.9184C96.7934 11.0379 96.6366 11.1685 96.5395 11.3104C96.4499 11.4523 96.4051 11.5979 96.4051 11.7472Z" fill="#092540"/>
                    <path d="M93.4077 4.6464C93.1464 4.6464 92.9299 4.568 92.7581 4.4112C92.5939 4.2544 92.5117 4.05653 92.5117 3.8176C92.5117 3.57867 92.5939 3.38453 92.7581 3.2352C92.9299 3.0784 93.1464 3 93.4077 3C93.6691 3 93.8819 3.0784 94.0461 3.2352C94.2179 3.38453 94.3037 3.57867 94.3037 3.8176C94.3037 4.05653 94.2179 4.2544 94.0461 4.4112C93.8819 4.568 93.6691 4.6464 93.4077 4.6464ZM92.6909 11.064V5.5088H94.1245V11.064H92.6909Z" fill="#092540"/>
                    <path d="M89.9609 11.064V3H91.3945V11.064H89.9609Z" fill="#092540"/>
                    <path d="M87.2861 11.064V3H88.7197V11.064H87.2861Z" fill="#092540"/>
                    <path d="M83.5151 11.1984C82.9551 11.1984 82.4586 11.0789 82.0255 10.84C81.5924 10.6011 81.2527 10.2651 81.0063 9.832C80.7599 9.39893 80.6367 8.89867 80.6367 8.3312C80.6367 7.75627 80.7562 7.2448 80.9951 6.7968C81.2415 6.3488 81.5775 6.0016 82.0031 5.7552C82.4362 5.50133 82.9439 5.3744 83.5263 5.3744C84.0714 5.3744 84.553 5.49387 84.9711 5.7328C85.3893 5.97173 85.714 6.30027 85.9455 6.7184C86.1844 7.12907 86.3039 7.58827 86.3039 8.096C86.3039 8.17813 86.3002 8.264 86.2927 8.3536C86.2927 8.4432 86.289 8.53653 86.2815 8.6336H82.0591C82.089 9.06667 82.2383 9.4064 82.5071 9.6528C82.7834 9.8992 83.1157 10.0224 83.5039 10.0224C83.7951 10.0224 84.0378 9.95893 84.2319 9.832C84.4335 9.6976 84.5829 9.52587 84.6799 9.3168H86.1359C86.0314 9.66773 85.8559 9.9888 85.6095 10.28C85.3706 10.5637 85.0719 10.7877 84.7135 10.952C84.3626 11.1163 83.9631 11.1984 83.5151 11.1984ZM83.5263 6.5392C83.1754 6.5392 82.8655 6.64 82.5967 6.8416C82.3279 7.03573 82.1562 7.3344 82.0815 7.7376H84.8479C84.8255 7.37173 84.6911 7.08053 84.4447 6.864C84.1983 6.64747 83.8922 6.5392 83.5263 6.5392Z" fill="#092540"/>
                    <path d="M78.9438 11.064C78.3614 11.064 77.8948 10.9221 77.5438 10.6384C77.1929 10.3547 77.0174 9.85067 77.0174 9.1264V6.7072H76.0654V5.5088H77.0174L77.1854 4.0192H78.451V5.5088H79.9518V6.7072H78.451V9.1376C78.451 9.4064 78.507 9.59307 78.619 9.6976C78.7385 9.79467 78.9401 9.8432 79.2238 9.8432H79.9182V11.064H78.9438Z" fill="#092540"/>
                    <path d="M69.8789 11.064V5.5088H71.1445L71.2565 6.4496C71.4282 6.12107 71.6746 5.85973 71.9957 5.6656C72.3242 5.47147 72.7088 5.3744 73.1493 5.3744C73.8362 5.3744 74.3701 5.59093 74.7509 6.024C75.1317 6.45707 75.3221 7.09173 75.3221 7.928V11.064H73.8885V8.0624C73.8885 7.58453 73.7914 7.21867 73.5973 6.9648C73.4032 6.71093 73.1008 6.584 72.6901 6.584C72.2869 6.584 71.9546 6.72587 71.6933 7.0096C71.4394 7.29333 71.3125 7.68907 71.3125 8.1968V11.064H69.8789Z" fill="#092540"/>
                    <path d="M67.1826 11.064V3.224H68.6162V11.064H67.1826Z" fill="#092540"/>
                    <path d="M60.4883 11.064V5.5088H61.7651L61.8995 6.5504C62.1011 6.192 62.3736 5.90827 62.7171 5.6992C63.068 5.48267 63.4787 5.3744 63.9491 5.3744V6.8864H63.5459C63.2323 6.8864 62.9523 6.93493 62.7059 7.032C62.4595 7.12907 62.2653 7.29707 62.1235 7.536C61.9891 7.77493 61.9219 8.1072 61.9219 8.5328V11.064H60.4883Z" fill="#092540"/>
                    <path d="M56.7173 11.1984C56.1573 11.1984 55.6607 11.0789 55.2277 10.84C54.7946 10.6011 54.4549 10.2651 54.2085 9.832C53.9621 9.39893 53.8389 8.89867 53.8389 8.3312C53.8389 7.75627 53.9583 7.2448 54.1973 6.7968C54.4437 6.3488 54.7797 6.0016 55.2053 5.7552C55.6383 5.50133 56.1461 5.3744 56.7285 5.3744C57.2735 5.3744 57.7551 5.49387 58.1733 5.7328C58.5914 5.97173 58.9162 6.30027 59.1477 6.7184C59.3866 7.12907 59.5061 7.58827 59.5061 8.096C59.5061 8.17813 59.5023 8.264 59.4949 8.3536C59.4949 8.4432 59.4911 8.53653 59.4837 8.6336H55.2613C55.2911 9.06667 55.4405 9.4064 55.7093 9.6528C55.9855 9.8992 56.3178 10.0224 56.7061 10.0224C56.9973 10.0224 57.2399 9.95893 57.4341 9.832C57.6357 9.6976 57.785 9.52587 57.8821 9.3168H59.3381C59.2335 9.66773 59.0581 9.9888 58.8117 10.28C58.5727 10.5637 58.2741 10.7877 57.9157 10.952C57.5647 11.1163 57.1653 11.1984 56.7173 11.1984ZM56.7285 6.5392C56.3775 6.5392 56.0677 6.64 55.7989 6.8416C55.5301 7.03573 55.3583 7.3344 55.2837 7.7376H58.0501C58.0277 7.37173 57.8933 7.08053 57.6469 6.864C57.4005 6.64747 57.0943 6.5392 56.7285 6.5392Z" fill="#092540"/>
                    <path d="M46.9355 13.528V5.5088H48.2123L48.3691 6.304C48.5483 6.0576 48.7835 5.84107 49.0747 5.6544C49.3734 5.46773 49.7579 5.3744 50.2283 5.3744C50.751 5.3744 51.2177 5.50133 51.6283 5.7552C52.039 6.00907 52.3638 6.35627 52.6027 6.7968C52.8417 7.23733 52.9611 7.7376 52.9611 8.2976C52.9611 8.8576 52.8417 9.35787 52.6027 9.7984C52.3638 10.2315 52.039 10.5749 51.6283 10.8288C51.2177 11.0752 50.751 11.1984 50.2283 11.1984C49.8102 11.1984 49.4443 11.12 49.1307 10.9632C48.8171 10.8064 48.5633 10.5861 48.3691 10.3024V13.528H46.9355ZM49.9259 9.944C50.3814 9.944 50.7585 9.79093 51.0571 9.4848C51.3558 9.17867 51.5051 8.78293 51.5051 8.2976C51.5051 7.81227 51.3558 7.4128 51.0571 7.0992C50.7585 6.7856 50.3814 6.6288 49.9259 6.6288C49.463 6.6288 49.0822 6.7856 48.7835 7.0992C48.4923 7.40533 48.3467 7.80107 48.3467 8.2864C48.3467 8.77173 48.4923 9.1712 48.7835 9.4848C49.0822 9.79093 49.463 9.944 49.9259 9.944Z" fill="#092540"/>
                    <path d="M39.8535 13.528V5.5088H41.1303L41.2871 6.304C41.4663 6.0576 41.7015 5.84107 41.9927 5.6544C42.2914 5.46773 42.6759 5.3744 43.1463 5.3744C43.669 5.3744 44.1356 5.50133 44.5463 5.7552C44.957 6.00907 45.2818 6.35627 45.5207 6.7968C45.7596 7.23733 45.8791 7.7376 45.8791 8.2976C45.8791 8.8576 45.7596 9.35787 45.5207 9.7984C45.2818 10.2315 44.957 10.5749 44.5463 10.8288C44.1356 11.0752 43.669 11.1984 43.1463 11.1984C42.7282 11.1984 42.3623 11.12 42.0487 10.9632C41.7351 10.8064 41.4812 10.5861 41.2871 10.3024V13.528H39.8535ZM42.8439 9.944C43.2994 9.944 43.6764 9.79093 43.9751 9.4848C44.2738 9.17867 44.4231 8.78293 44.4231 8.2976C44.4231 7.81227 44.2738 7.4128 43.9751 7.0992C43.6764 6.7856 43.2994 6.6288 42.8439 6.6288C42.381 6.6288 42.0002 6.7856 41.7015 7.0992C41.4103 7.40533 41.2647 7.80107 41.2647 8.2864C41.2647 8.77173 41.4103 9.1712 41.7015 9.4848C42.0002 9.79093 42.381 9.944 42.8439 9.944Z" fill="#092540"/>
                    <path d="M35.9512 11.1984C35.4136 11.1984 34.9283 11.0752 34.4952 10.8288C34.0696 10.5824 33.7299 10.2427 33.476 9.8096C33.2296 9.36907 33.1064 8.86133 33.1064 8.2864C33.1064 7.71147 33.2334 7.20747 33.4872 6.7744C33.7411 6.33387 34.0808 5.9904 34.5064 5.744C34.9395 5.4976 35.4248 5.3744 35.9624 5.3744C36.4926 5.3744 36.9704 5.4976 37.396 5.744C37.8291 5.9904 38.1688 6.33387 38.4152 6.7744C38.6691 7.20747 38.796 7.71147 38.796 8.2864C38.796 8.86133 38.6691 9.36907 38.4152 9.8096C38.1688 10.2427 37.8291 10.5824 37.396 10.8288C36.963 11.0752 36.4814 11.1984 35.9512 11.1984ZM35.9512 9.9552C36.3246 9.9552 36.6494 9.81707 36.9256 9.5408C37.2019 9.25707 37.34 8.83893 37.34 8.2864C37.34 7.73387 37.2019 7.31947 36.9256 7.0432C36.6494 6.75947 36.3283 6.6176 35.9624 6.6176C35.5816 6.6176 35.2531 6.75947 34.9768 7.0432C34.708 7.31947 34.5736 7.73387 34.5736 8.2864C34.5736 8.83893 34.708 9.25707 34.9768 9.5408C35.2531 9.81707 35.5779 9.9552 35.9512 9.9552Z" fill="#092540"/>
                    <path d="M26.6953 11.064V3H28.1289V6.36C28.3156 6.05387 28.5657 5.81493 28.8793 5.6432C29.2004 5.464 29.5662 5.3744 29.9769 5.3744C30.6638 5.3744 31.194 5.59093 31.5673 6.024C31.9481 6.45707 32.1385 7.09173 32.1385 7.928V11.064H30.7161V8.0624C30.7161 7.58453 30.619 7.21867 30.4249 6.9648C30.2382 6.71093 29.9396 6.584 29.5289 6.584C29.1257 6.584 28.7897 6.72587 28.5209 7.0096C28.2596 7.29333 28.1289 7.68907 28.1289 8.1968V11.064H26.6953Z" fill="#092540"/>
                    <path d="M22.947 11.1984C22.3721 11.1984 21.8644 11.1013 21.4238 10.9072C20.9833 10.7056 20.6361 10.4219 20.3822 10.056C20.1284 9.68267 19.9977 9.23093 19.9902 8.7008H21.5022C21.5172 9.06667 21.6478 9.37653 21.8942 9.6304C22.1481 9.8768 22.4953 10 22.9358 10C23.3166 10 23.619 9.9104 23.843 9.7312C24.067 9.54453 24.179 9.29813 24.179 8.992C24.179 8.67093 24.0782 8.4208 23.8766 8.2416C23.6825 8.0624 23.4212 7.9168 23.0926 7.8048C22.7641 7.6928 22.4132 7.57333 22.0398 7.4464C21.435 7.23733 20.9721 6.96853 20.651 6.64C20.3374 6.31147 20.1806 5.87467 20.1806 5.3296C20.1732 4.86667 20.2814 4.47093 20.5054 4.1424C20.7369 3.8064 21.0505 3.5488 21.4462 3.3696C21.842 3.18293 22.2974 3.0896 22.8126 3.0896C23.3353 3.0896 23.7945 3.18293 24.1902 3.3696C24.5934 3.55627 24.907 3.8176 25.131 4.1536C25.3625 4.4896 25.4857 4.88907 25.5006 5.352H23.9662C23.9588 5.07573 23.8505 4.83307 23.6414 4.624C23.4398 4.40747 23.1561 4.2992 22.7902 4.2992C22.4766 4.29173 22.2116 4.37013 21.995 4.5344C21.786 4.6912 21.6814 4.92267 21.6814 5.2288C21.6814 5.49013 21.7636 5.6992 21.9278 5.856C22.0921 6.00533 22.3161 6.13227 22.5998 6.2368C22.8836 6.34133 23.2084 6.45333 23.5742 6.5728C23.9625 6.7072 24.3172 6.864 24.6382 7.0432C24.9593 7.2224 25.2169 7.46133 25.411 7.76C25.6052 8.0512 25.7022 8.42827 25.7022 8.8912C25.7022 9.30187 25.5977 9.68267 25.3886 10.0336C25.1796 10.3845 24.8697 10.6683 24.459 10.8848C24.0484 11.0939 23.5444 11.1984 22.947 11.1984Z" fill="#092540"/>
                    <path d="M187.468 10.9113C187.171 10.9113 186.898 10.8675 186.648 10.7798C186.405 10.6853 186.193 10.5605 186.011 10.4054C185.828 10.2435 185.683 10.0614 185.575 9.85899L185.515 10.7899H184.867V3.50448H185.575V6.6109C185.744 6.32083 185.987 6.07461 186.304 5.87224C186.621 5.66987 187.009 5.56868 187.468 5.56868C187.967 5.56868 188.402 5.68673 188.773 5.92283C189.144 6.15219 189.427 6.46924 189.623 6.87399C189.825 7.27199 189.927 7.72732 189.927 8.24C189.927 8.75268 189.825 9.21139 189.623 9.61614C189.421 10.0209 189.134 10.3379 188.763 10.5673C188.399 10.7966 187.967 10.9113 187.468 10.9113ZM187.417 10.2941C187.775 10.2941 188.085 10.2098 188.348 10.0411C188.611 9.87248 188.82 9.633 188.975 9.3227C189.131 9.01239 189.208 8.65149 189.208 8.24C189.208 7.82176 189.131 7.46087 188.975 7.15731C188.82 6.847 188.608 6.60753 188.338 6.43888C188.075 6.27024 187.768 6.18592 187.417 6.18592C187.066 6.18592 186.753 6.27024 186.476 6.43888C186.206 6.60753 185.994 6.847 185.839 7.15731C185.69 7.46761 185.616 7.82851 185.616 8.24C185.616 8.65824 185.69 9.02251 185.839 9.33282C185.994 9.63638 186.206 9.87248 186.476 10.0411C186.753 10.2098 187.066 10.2941 187.417 10.2941Z" fill="#092540"/>
                    <path d="M181.594 10.9113C181.122 10.9113 180.703 10.8 180.339 10.5774C179.982 10.3548 179.698 10.0445 179.489 9.6465C179.287 9.24175 179.186 8.76955 179.186 8.22988C179.186 7.69022 179.287 7.22139 179.489 6.82339C179.691 6.42539 179.975 6.11846 180.339 5.9026C180.71 5.67999 181.135 5.56868 181.614 5.56868C182.106 5.56868 182.521 5.67999 182.859 5.9026C183.203 6.12521 183.462 6.41527 183.638 6.7728C183.82 7.13032 183.911 7.52158 183.911 7.94656C183.911 8.01402 183.911 8.08485 183.911 8.15905C183.911 8.22651 183.908 8.30746 183.901 8.4019H179.722V7.8049H183.223C183.209 7.28548 183.047 6.8841 182.737 6.60078C182.434 6.31746 182.049 6.1758 181.584 6.1758C181.28 6.1758 180.997 6.24663 180.734 6.38829C180.477 6.52321 180.268 6.72558 180.106 6.99541C179.951 7.25849 179.874 7.59241 179.874 7.99716V8.26024C179.874 8.71895 179.955 9.10009 180.116 9.40365C180.278 9.70721 180.491 9.93319 180.754 10.0816C181.024 10.23 181.304 10.3042 181.594 10.3042C181.978 10.3042 182.295 10.2199 182.545 10.0512C182.795 9.87585 182.973 9.63638 183.081 9.33282H183.779C183.692 9.62963 183.55 9.89946 183.354 10.1423C183.166 10.3852 182.923 10.574 182.626 10.709C182.329 10.8439 181.985 10.9113 181.594 10.9113Z" fill="#092540"/>
                    <path d="M173.292 10.7899L171.794 5.69011H172.512L173.727 10.0512H173.585L174.9 5.69011H175.71L177.025 10.0512H176.884L178.098 5.69011H178.816L177.319 10.7899H176.6L175.234 6.22639H175.376L174.01 10.7899H173.292Z" fill="#092540"/>
                    <path d="M168.785 10.7899V5.69011H169.433L169.483 6.67161C169.591 6.43551 169.736 6.23651 169.918 6.07461C170.101 5.91271 170.32 5.78792 170.576 5.70022C170.832 5.61253 171.123 5.56868 171.446 5.56868V6.30734H171.173C170.957 6.30734 170.748 6.3377 170.546 6.39841C170.343 6.45238 170.165 6.54682 170.01 6.68173C169.854 6.81665 169.73 6.99878 169.635 7.22814C169.541 7.45749 169.493 7.74419 169.493 8.08822V10.7899H168.785Z" fill="#092540"/>
                    <path d="M165.242 10.9113C164.83 10.9113 164.486 10.8371 164.21 10.6887C163.94 10.5403 163.737 10.3481 163.602 10.112C163.474 9.87585 163.41 9.61614 163.41 9.33282C163.41 8.98204 163.498 8.68522 163.673 8.44237C163.855 8.19953 164.108 8.01739 164.432 7.89597C164.756 7.77455 165.134 7.71383 165.565 7.71383H166.942C166.942 7.38329 166.891 7.10334 166.79 6.87399C166.689 6.64463 166.54 6.47261 166.345 6.35794C166.149 6.23651 165.903 6.1758 165.606 6.1758C165.262 6.1758 164.965 6.26349 164.715 6.43888C164.466 6.61427 164.311 6.87061 164.25 7.2079H163.511C163.552 6.85038 163.673 6.55019 163.876 6.30734C164.085 6.06449 164.341 5.88236 164.645 5.76094C164.948 5.63277 165.269 5.56868 165.606 5.56868C166.078 5.56868 166.463 5.65975 166.759 5.84188C167.056 6.01727 167.279 6.26012 167.427 6.57043C167.576 6.88073 167.65 7.23826 167.65 7.643V10.7899H167.002L166.962 9.85899C166.901 10.0006 166.817 10.1356 166.709 10.2637C166.608 10.3919 166.486 10.5032 166.345 10.5976C166.21 10.6921 166.051 10.7663 165.869 10.8203C165.687 10.881 165.478 10.9113 165.242 10.9113ZM165.323 10.2941C165.572 10.2941 165.795 10.2435 165.99 10.1423C166.193 10.0344 166.365 9.89609 166.506 9.72744C166.648 9.5588 166.756 9.36992 166.83 9.1608C166.904 8.94494 166.942 8.72233 166.942 8.49297V8.31083H165.616C165.258 8.31083 164.972 8.35468 164.756 8.44237C164.54 8.53007 164.385 8.64812 164.29 8.79653C164.196 8.94493 164.149 9.11695 164.149 9.31258C164.149 9.50821 164.193 9.68022 164.28 9.82863C164.368 9.97029 164.5 10.085 164.675 10.1727C164.857 10.2536 165.073 10.2941 165.323 10.2941Z" fill="#092540"/>
                    <path d="M161.671 10.7899V3.50448H162.379V10.7899H161.671Z" fill="#092540"/>
                    <path d="M159.632 10.7899V5.6901H160.33V10.7899H159.632ZM159.986 4.48598C159.844 4.48598 159.723 4.43876 159.622 4.34432C159.52 4.24314 159.47 4.11834 159.47 3.96993C159.47 3.81478 159.517 3.69336 159.611 3.60566C159.713 3.51122 159.834 3.464 159.976 3.464C160.117 3.464 160.239 3.51122 160.34 3.60566C160.441 3.69336 160.492 3.81478 160.492 3.96993C160.492 4.11834 160.441 4.24314 160.34 4.34432C160.245 4.43876 160.127 4.48598 159.986 4.48598Z" fill="#092540"/>
                    <path d="M150.839 10.7899V5.69011H151.486L151.537 6.45912C151.692 6.1758 151.908 5.95656 152.185 5.80141C152.461 5.64626 152.768 5.56868 153.105 5.56868C153.355 5.56868 153.588 5.60578 153.804 5.67999C154.019 5.75419 154.208 5.86549 154.37 6.0139C154.539 6.16231 154.67 6.35456 154.765 6.59066C154.934 6.27361 155.17 6.02402 155.473 5.84188C155.784 5.65975 156.114 5.56868 156.465 5.56868C156.856 5.56868 157.193 5.64626 157.477 5.80141C157.767 5.95656 157.993 6.19266 158.155 6.50972C158.317 6.82677 158.397 7.22814 158.397 7.71383V10.7899H157.689V7.79478C157.689 7.25512 157.578 6.85375 157.355 6.59066C157.133 6.32083 156.822 6.18592 156.424 6.18592C156.155 6.18592 155.908 6.26012 155.686 6.40853C155.463 6.55019 155.288 6.75931 155.16 7.03588C155.031 7.30571 154.967 7.643 154.967 8.04775V10.7899H154.259V7.79478C154.259 7.25512 154.148 6.85375 153.925 6.59066C153.709 6.32083 153.402 6.18592 153.004 6.18592C152.728 6.18592 152.478 6.26012 152.255 6.40853C152.04 6.55019 151.868 6.76268 151.739 7.046C151.611 7.32258 151.547 7.66661 151.547 8.0781V10.7899H150.839Z" fill="#092540"/>
                    <path d="M148.802 10.7899V5.6901H149.5V10.7899H148.802ZM149.156 4.48598C149.014 4.48598 148.893 4.43876 148.791 4.34432C148.69 4.24314 148.64 4.11834 148.64 3.96993C148.64 3.81478 148.687 3.69336 148.781 3.60566C148.882 3.51122 149.004 3.464 149.146 3.464C149.287 3.464 149.409 3.51122 149.51 3.60566C149.611 3.69336 149.662 3.81478 149.662 3.96993C149.662 4.11834 149.611 4.24314 149.51 4.34432C149.415 4.43876 149.297 4.48598 149.156 4.48598Z" fill="#092540"/>
                    <path d="M145.349 10.9113C144.83 10.9113 144.378 10.8169 143.993 10.628C143.615 10.4391 143.325 10.176 143.123 9.83875C142.921 9.49471 142.819 9.10346 142.819 8.66498H143.558C143.558 8.9618 143.625 9.235 143.76 9.48459C143.895 9.73419 144.094 9.93656 144.357 10.0917C144.62 10.2401 144.951 10.3143 145.349 10.3143C145.7 10.3143 145.993 10.257 146.229 10.1423C146.472 10.0209 146.658 9.86236 146.786 9.66673C146.914 9.4711 146.978 9.24849 146.978 8.9989C146.978 8.70209 146.914 8.46261 146.786 8.28048C146.664 8.09834 146.496 7.94993 146.28 7.83525C146.064 7.72058 145.818 7.62276 145.541 7.54181C145.271 7.45412 144.985 7.35968 144.681 7.25849C144.135 7.06961 143.733 6.83688 143.477 6.56031C143.221 6.28373 143.089 5.92958 143.082 5.49785C143.082 5.12683 143.167 4.79966 143.335 4.51634C143.511 4.22627 143.764 4.00029 144.094 3.83839C144.425 3.66975 144.816 3.58543 145.268 3.58543C145.707 3.58543 146.088 3.66975 146.411 3.83839C146.742 4.00029 146.998 4.22965 147.18 4.52646C147.363 4.81653 147.454 5.15044 147.454 5.52821H146.725C146.725 5.31234 146.668 5.10322 146.553 4.90085C146.445 4.69173 146.28 4.52309 146.057 4.39492C145.841 4.26 145.565 4.19254 145.228 4.19254C144.951 4.19254 144.705 4.24314 144.489 4.34432C144.28 4.43876 144.115 4.58043 143.993 4.76931C143.872 4.95144 143.811 5.16731 143.811 5.4169C143.811 5.65975 143.865 5.85875 143.973 6.0139C144.081 6.16905 144.233 6.29722 144.428 6.39841C144.624 6.49959 144.853 6.59404 145.116 6.68173C145.379 6.76268 145.673 6.85712 145.997 6.96505C146.327 7.07973 146.621 7.21802 146.877 7.37992C147.133 7.54182 147.336 7.75093 147.484 8.00727C147.632 8.25686 147.707 8.57392 147.707 8.95842C147.707 9.28897 147.619 9.60602 147.444 9.90958C147.275 10.2064 147.015 10.4492 146.664 10.6381C146.314 10.8203 145.875 10.9113 145.349 10.9113Z" fill="#092540"/>
                    <path d="M135.723 13.016L136.977 10.2233H136.704L134.69 5.69011H135.459L137.2 9.73756L139.031 5.69011H139.76L136.461 13.016H135.723Z" fill="#092540"/>
                    <path d="M132.109 10.9113C131.812 10.9113 131.539 10.8675 131.29 10.7798C131.047 10.6853 130.834 10.5605 130.652 10.4054C130.47 10.2435 130.325 10.0614 130.217 9.85899L130.156 10.7899H129.509V3.50448H130.217V6.6109C130.386 6.32083 130.629 6.07461 130.946 5.87224C131.263 5.66987 131.651 5.56868 132.109 5.56868C132.608 5.56868 133.044 5.68673 133.415 5.92283C133.786 6.15219 134.069 6.46924 134.265 6.87399C134.467 7.27199 134.568 7.72732 134.568 8.24C134.568 8.75268 134.467 9.21139 134.265 9.61614C134.062 10.0209 133.775 10.3379 133.404 10.5673C133.04 10.7966 132.608 10.9113 132.109 10.9113ZM132.059 10.2941C132.416 10.2941 132.727 10.2098 132.99 10.0411C133.253 9.87248 133.462 9.633 133.617 9.3227C133.772 9.01239 133.85 8.65149 133.85 8.24C133.85 7.82176 133.772 7.46087 133.617 7.15731C133.462 6.847 133.249 6.60753 132.979 6.43888C132.716 6.27024 132.409 6.18592 132.059 6.18592C131.708 6.18592 131.394 6.27024 131.118 6.43888C130.848 6.60753 130.635 6.847 130.48 7.15731C130.332 7.46761 130.258 7.82851 130.258 8.24C130.258 8.65824 130.332 9.02251 130.48 9.33282C130.635 9.63638 130.848 9.87248 131.118 10.0411C131.394 10.2098 131.708 10.2941 132.059 10.2941Z" fill="#092540"/>
                    <circle cx="8" cy="8" r="8" fill="#C343FF"/>
                    <mask id="mask0_215_8818" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">
                    <circle cx="8" cy="8" r="8" fill="#C343FF"/>
                    </mask>
                    <g mask="url(#mask0_215_8818)">
                    <path d="M12.8454 18.0938H-1.0668C-1.21474 18.0938 -1.33398 17.9893 -1.33398 17.8609L-0.993465 5.01595H12.7727L13.1132 17.8609C13.1126 17.9898 12.9933 18.0938 12.8454 18.0938Z" fill="url(#paint0_linear_215_8818)"/>
                    <path d="M8.65981 7.10073C8.93306 7.10073 9.15457 6.88858 9.15457 6.62689C9.15457 6.3652 8.93306 6.15306 8.65981 6.15306C8.38655 6.15306 8.16504 6.3652 8.16504 6.62689C8.16504 6.88858 8.38655 7.10073 8.65981 7.10073Z" fill="#C343FF"/>
                    <path d="M3.11879 7.10073C3.39204 7.10073 3.61356 6.88858 3.61356 6.62689C3.61356 6.3652 3.39204 6.15306 3.11879 6.15306C2.84554 6.15306 2.62402 6.3652 2.62402 6.62689C2.62402 6.88858 2.84554 7.10073 3.11879 7.10073Z" fill="#C343FF"/>
                    <path d="M5.87577 12.4389C4.20646 12.4389 2.84863 10.9813 2.84863 9.18932V6.99517C2.84863 6.87241 2.95246 6.77298 3.08064 6.77298C3.20883 6.77298 3.31265 6.87241 3.31265 6.99517V9.18932C3.31265 10.7363 4.46225 11.9945 5.87577 11.9945C7.2887 11.9945 8.43889 10.7363 8.43889 9.18932V6.99517C8.43889 6.87241 8.54271 6.77298 8.6709 6.77298C8.79908 6.77298 8.90291 6.87241 8.90291 6.99517V9.18932C8.90291 10.9813 7.54507 12.4389 5.87577 12.4389Z" fill="url(#paint1_linear_215_8818)"/>
                    <path d="M11.2564 3.87867L12.779 5.01587H-0.994141L0.522263 3.87867H11.2564Z" fill="url(#paint2_linear_215_8818)"/>
                    </g>
                    <g filter="url(#filter0_d_215_8818)">
                    <circle cx="12.9333" cy="13.0666" r="2.93333" fill="white"/>
                    </g>
                    <path d="M14.6166 12.0365C14.4008 11.7065 14.0874 11.4284 13.7283 11.2893L13.6225 11.254C13.4896 11.2146 13.3693 11.198 13.2593 11.2001C12.8711 11.2021 12.5557 11.5176 12.5557 11.9057C12.5557 12.0676 12.6096 12.217 12.7009 12.3354L12.6574 12.2814C12.7694 12.4433 12.95 12.6072 13.2032 12.8003C13.7076 13.1842 14.0355 13.5246 14.0625 13.9459C14.0687 14.002 14.0728 14.0601 14.0728 14.1203C14.0728 14.334 14.0251 14.5623 13.9442 14.7221C13.9442 14.7221 13.911 14.7803 13.9317 14.8031C13.94 14.8114 13.967 14.8197 14.0085 14.7948C14.2326 14.6516 14.4277 14.4648 14.5813 14.2448C14.8055 13.9231 14.9279 13.5412 14.9321 13.1489C14.9425 12.7504 14.8304 12.3665 14.6166 12.0365Z" fill="#FF8126"/>
                    <path d="M13.1239 13.4789L12.8063 13.2236C12.1422 12.7484 11.7977 12.2378 11.9865 11.6068C12.0031 11.5487 12.0239 11.4927 12.0488 11.4387C12.0488 11.4387 12.0965 11.3412 11.9927 11.3889C11.7748 11.5052 11.5756 11.6629 11.4116 11.8559C11.1273 12.1859 10.9592 12.6031 10.9363 13.0389C10.9135 13.4748 11.0339 13.9065 11.2829 14.2655C11.3846 14.4046 11.5071 14.525 11.6461 14.6246C12.3456 15.1289 12.9454 14.8633 12.9454 14.8633C13.238 14.745 13.4456 14.4565 13.4456 14.1203C13.4435 13.8567 13.319 13.6242 13.1239 13.4789Z" fill="#092540"/>
                    <defs>
                    <filter id="filter0_d_215_8818" x="8.4" y="8.53322" width="9.06621" height="9.06667" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                    <feOffset/>
                    <feGaussianBlur stdDeviation="0.8"/>
                    <feComposite in2="hardAlpha" operator="out"/>
                    <feColorMatrix type="matrix" values="0 0 0 0 0.0352941 0 0 0 0 0.145098 0 0 0 0 0.25098 0 0 0 0.15 0"/>
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_215_8818"/>
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_215_8818" result="shape"/>
                    </filter>
                    <linearGradient id="paint0_linear_215_8818" x1="11.0352" y1="5.20548" x2="6.14281" y2="20.6314" gradientUnits="userSpaceOnUse">
                    <stop stop-color="white"/>
                    <stop offset="1" stop-color="white" stop-opacity="0.16"/>
                    </linearGradient>
                    <linearGradient id="paint1_linear_215_8818" x1="5.98905" y1="7.00601" x2="6.07981" y2="13.6398" gradientUnits="userSpaceOnUse">
                    <stop stop-color="white"/>
                    <stop offset="0.65625" stop-color="white"/>
                    </linearGradient>
                    <linearGradient id="paint2_linear_215_8818" x1="-2.96214" y1="2.12482" x2="11.144" y2="9.15595" gradientUnits="userSpaceOnUse">
                    <stop stop-color="white"/>
                    <stop offset="1" stop-color="white" stop-opacity="0.15"/>
                    </linearGradient>
                    </defs>
                    </svg>

            </div>
        </div>
    `;
}

function createRightColLinksBox(dateRange, domain, brand, category, categoryId, parentAsin, childAsin) {
    // Create main container frame
    const mainFrame = document.createElement('div');
    mainFrame.className = 'sw-shopper-box'; // Add unique class name
    mainFrame.style.cssText = `
        width: 244px;
        height: auto;
        background: #FFFFFF;
        border: 1px solid #D9D9D9;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 0;
        margin-bottom: 8px;
        transition: all 0.2s ease-in-out;
    `;

    // Add hover effect to main frame
    mainFrame.addEventListener('mouseenter', () => {
        mainFrame.style.boxShadow = '0px 4px 8px rgba(9, 37, 64, 0.04)';
        mainFrame.style.transform = 'translateY(-0.5px)';
        mainFrame.style.borderColor = '#C343FF';
        const headerFrame = mainFrame.querySelector('.header-frame');
        if (headerFrame) {
            headerFrame.style.borderColor = '#C343FF';
        }
    });

    mainFrame.addEventListener('mouseleave', () => {
        mainFrame.style.boxShadow = '0px 0px 0px rgba(9, 37, 64, 0)';
        mainFrame.style.transform = 'translateY(0)';
        mainFrame.style.borderColor = '#D9D9D9';
        const headerFrame = mainFrame.querySelector('.header-frame');
        if (headerFrame) {
            headerFrame.style.borderColor = '#D9D9D9';
        }
    });

    // Create header frame
    const headerFrame = document.createElement('div');
    headerFrame.className = 'header-frame';
    headerFrame.style.cssText = `
        width: 100%;
        height: 32px;
        background: #FFFFFF;
        border-bottom: 1px solid #D9D9D9;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px 16px;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s ease-in-out;
    `;

    // Create logo link
    const logoLink = document.createElement('a');
    logoLink.href = 'https://shopper.similarweb.com';
    logoLink.target = '_blank';
    logoLink.style.cssText = `
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
    `;

    // Add logo to header
    const logoContainer = document.createElement('div');
    logoContainer.innerHTML = getShopperLogo();
    logoContainer.style.cssText = `
        transform: scale(0.9);
        transform-origin: center center;
    `;
    
    logoLink.appendChild(logoContainer);
    headerFrame.appendChild(logoLink);

    // Create content frame
    const contentFrame = document.createElement('div');
    contentFrame.style.cssText = `
        padding: 0 14px 12px 14px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    `;

    // Create link items
    const items = [
        {
            title: 'Category',
            value: category,
            href: `https://shopper.similarweb.com/categories/sales-performance?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&category=${categoryId}&comparison=yoy`
        },
        {
            title: 'Brand',
            value: brand,
            href: `https://shopper.similarweb.com/brands/sales-performance?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&brand=${encodeURIComponent(brand)}&brandCategory=${categoryId}&comparison=yoy`
        },
        {
            title: 'Parent ASIN',
            value: parentAsin,
            href: `https://shopper.similarweb.com/product/reports?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&comparison=yoy&asinGroupId=asin-${parentAsin}`
        }
    ];

    if (childAsin !== parentAsin) {
        items.push({
            title: 'Child ASIN',
            value: childAsin,
            href: `https://shopper.similarweb.com/product/reports?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&comparison=yoy&asinGroupId=asin-${childAsin}`
        });
    }

    items.forEach(item => {
        const itemContainer = document.createElement('div');
        itemContainer.style.cssText = `
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 16px;
            position: relative;
        `;

        const title = document.createElement('span');
        title.textContent = item.title;
        title.style.cssText = `
            color: #092540;
            font-size: 12px;
            line-height: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        `;

        const linkContainer = document.createElement('div');
        linkContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 4px;
            position: relative;
        `;

        const link = document.createElement('a');
        link.href = item.href;
        link.target = '_blank';
        link.textContent = item.value;
        
        // Create custom tooltip
        const tooltip = document.createElement('div');
        tooltip.textContent = item.value;
        tooltip.style.cssText = `
            position: absolute;
            background: #092540;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.1s;
            top: 20px;
            left: 0;
            z-index: 999999999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            box-shadow: 0px 4px 8px rgba(9, 37, 64, 0.08);
            visibility: hidden;
            transition-delay: 0.25s;
        `;

        link.style.cssText = `
            color: #195AFF;
            font-size: 14px;
            line-height: 16px;
            text-decoration: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: block;
        `;

        link.addEventListener('mouseover', () => {
            link.style.color = '#0235B6';
            link.style.textDecoration = 'underline';
            if (link.scrollWidth > link.clientWidth) {
                tooltip.style.opacity = '1';
                tooltip.style.visibility = 'visible';
            }
        });

        link.addEventListener('mouseout', () => {
            link.style.color = '#195AFF';
            link.style.textDecoration = 'none';
            tooltip.style.opacity = '0';
            tooltip.style.visibility = 'hidden';
        });

        linkContainer.appendChild(link);
        linkContainer.appendChild(tooltip);

        // Add chevron icon with dropdown functionality
        const chevronIcon = document.createElement('div');
        chevronIcon.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="cursor: pointer;">
                <path d="M4 6L8 10.6667L12 6" stroke="#195AFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="chevron-path"/>
            </svg>
        `;
        chevronIcon.style.cssText = `
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
            transform: scaleY(1);
            transform-origin: center center;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        `;

        // Add hover effect to chevron
        chevronIcon.addEventListener('mouseover', () => {
            const path = chevronIcon.querySelector('.chevron-path');
            if (path && dropdownMenu.style.display === 'none') {
                path.style.stroke = '#0235B6';
            }
        });

        chevronIcon.addEventListener('mouseout', () => {
            const path = chevronIcon.querySelector('.chevron-path');
            if (path && dropdownMenu.style.display === 'none') {
                path.style.stroke = '#195AFF';
            }
        });

        // Create dropdown menu
        const dropdownMenu = document.createElement('div');
        dropdownMenu.style.cssText = `
            position: fixed;
            background: white;
            border: 1px solid #D9D9D9;
            border-radius: 4px;
            box-shadow: 0px 4px 8px rgba(9, 37, 64, 0.08);
            z-index: 999999999;
            display: none;
            min-width: 160px;
        `;

        // Add dropdown options
        const options = [
            {
                text: 'Sales Performance',
                action: () => {
                    window.open(item.href, '_blank');
                }
            },
            {
                text: 'Search Optimization',
                action: () => {
                    let searchOptUrl;
                    switch(item.title) {
                        case 'Category':
                            searchOptUrl = `https://shopper.similarweb.com/categories/on-site-search?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&category=${categoryId}&comparison=yoy`;
                            break;
                        case 'Brand':
                            searchOptUrl = `https://shopper.similarweb.com/brands/on-site-search?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&brand=${encodeURIComponent(brand)}&brandCategory=${categoryId}&comparison=yoy`;
                            break;
                        case 'Parent ASIN':
                        case 'Child ASIN':
                            searchOptUrl = `https://shopper.similarweb.com/product/on-site-search?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&comparison=yoy&asinGroupId=asin-${item.value}`;
                            break;
                    }
                    window.open(searchOptUrl, '_blank');
                }
            },
            ...(item.title === 'Brand' ? [
                {
                    text: 'Marketing Channels',
                    action: () => {
                        const marketingUrl = `https://shopper.similarweb.com/traffic-sources/marketing-channels?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&brandCategory=${categoryId}&brand=${encodeURIComponent(brand)}&comparison=yoy`;
                        window.open(marketingUrl, '_blank');
                    }
                },
                {
                    text: 'Google Searches',
                    action: () => {
                        const searchesUrl = `https://shopper.similarweb.com/traffic-sources/google-search?from=${dateRange.start}&to=${dateRange.end}&domain=${domain}&brandCategory=${categoryId}&brand=${encodeURIComponent(brand)}&comparison=yoy&trafficType=all`;
                        window.open(searchesUrl, '_blank');
                    }
                }
            ] : []),
            {
                text: 'Copy to Clipboard',
                action: () => {
                    navigator.clipboard.writeText(item.value);
                    showToast('Copied to Clipboard');
                }
            }
        ];

        options.forEach(option => {
            const optionElement = document.createElement('div');
            optionElement.style.cssText = `
                padding: 8px 12px;
                font-size: 14px;
                color: #092540;
                cursor: pointer;
                transition: background-color 0.2s;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;

            optionElement.textContent = option.text;

            optionElement.addEventListener('mouseover', () => {
                optionElement.style.backgroundColor = '#F5F7FA';
            });

            optionElement.addEventListener('mouseout', () => {
                optionElement.style.backgroundColor = 'transparent';
            });

            optionElement.addEventListener('click', (e) => {
                e.stopPropagation();
                option.action();
                dropdownMenu.style.display = 'none';
                // Reset chevron state
                chevronIcon.style.transform = 'scaleY(1)';
                const path = chevronIcon.querySelector('.chevron-path');
                if (path) {
                    path.style.stroke = '#195AFF';
                }
            });

            dropdownMenu.appendChild(optionElement);
        });

        // Add class for easier selection
        dropdownMenu.className = 'dropdown-menu';

        // Append dropdown to body
        document.body.appendChild(dropdownMenu);

        // Add click handler for chevron
        chevronIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            const path = chevronIcon.querySelector('.chevron-path');
            
            // Close all other dropdowns first
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (menu !== dropdownMenu) {
                    menu.style.display = 'none';
                }
                // Reset all other chevrons
                const allChevrons = document.querySelectorAll('.chevron-icon');
                allChevrons.forEach(chev => {
                    if (chev !== chevronIcon) {
                        chev.style.transform = 'scaleY(1)';
                        const chevPath = chev.querySelector('.chevron-path');
                        if (chevPath) {
                            chevPath.style.stroke = '#195AFF';
                        }
                    }
                });
            });

            if (dropdownMenu.style.display === 'none') {
                // Position dropdown relative to chevron icon
                const rect = chevronIcon.getBoundingClientRect();
                const scrollTop = window.scrollY || document.documentElement.scrollTop;
                const scrollLeft = window.scrollX || document.documentElement.scrollLeft;
                dropdownMenu.style.top = `${rect.bottom + scrollTop + 4}px`;
                dropdownMenu.style.left = `${rect.left + scrollLeft}px`;
                dropdownMenu.style.display = 'block';
                // Flip chevron up and change color
                chevronIcon.style.transform = 'scaleY(-1)';
                if (path) {
                    path.style.stroke = '#0235B6';
                }
            } else {
                dropdownMenu.style.display = 'none';
                // Flip chevron down and restore color
                chevronIcon.style.transform = 'scaleY(1)';
                if (path) {
                    path.style.stroke = '#195AFF';
                }
            }
        });

        // Add class for easier selection
        chevronIcon.className = 'chevron-icon';
        dropdownMenu.className = 'dropdown-menu';

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            dropdownMenu.style.display = 'none';
            chevronIcon.style.transform = 'scaleY(1)';
            const path = chevronIcon.querySelector('.chevron-path');
            if (path) {
                path.style.stroke = '#195AFF';
            }
        });

        // Close dropdown when scrolling
        document.addEventListener('scroll', () => {
            dropdownMenu.style.display = 'none';
            chevronIcon.style.transform = 'scaleY(1)';
            const path = chevronIcon.querySelector('.chevron-path');
            if (path) {
                path.style.stroke = '#195AFF';
            }
        }, true);

        linkContainer.appendChild(link);
        linkContainer.appendChild(chevronIcon);
        itemContainer.appendChild(title);
        itemContainer.appendChild(linkContainer);
        contentFrame.appendChild(itemContainer);
    });

    mainFrame.appendChild(headerFrame);
    mainFrame.appendChild(contentFrame);
    return mainFrame;
}

function displayProductInfo() {
    if (!isProductPage()) return;

    // Remove ALL existing boxes first
    const existingBoxes = document.querySelectorAll('.sw-shopper-box');
    existingBoxes.forEach(box => box.remove());

    const productTitle = getProductTitle();
    const parentAsin = getParentASIN();
    const childAsin = getASIN();
    const brand = getBrand();
    const category = getCategory();
    
    if (!productTitle || !parentAsin) return;

    const dateRange = getLastTwelveMonthsRange();
    const domain = getAmazonDomain();
    const categoryId = getCategoryId();

    // Create and insert right column links box
    const rightCol = document.getElementById('rightCol');
    if (rightCol) {
        const rightColLinksBox = createRightColLinksBox(dateRange, domain, brand, category, categoryId, parentAsin, childAsin);
        rightCol.insertBefore(rightColLinksBox, rightCol.firstChild);
    }
}

// Run when the page loads
displayProductInfo();

// Also run when the URL changes (for single-page navigation)
let lastUrl = location.href;
new MutationObserver(() => {
    const url = location.href;
    if (url !== lastUrl) {
        lastUrl = url;
        displayProductInfo();
    }
}).observe(document, {subtree: true, childList: true});

// Add function to get category ID
function getCategoryId() {
    // Method 1: Look for category ID in breadcrumb links
    const breadcrumbLinks = document.querySelectorAll('div[id="wayfinding-breadcrumbs_feature_div"] a');
    let lastNodeId = '-1';
    
    // Iterate through all links and keep updating lastNodeId
    breadcrumbLinks.forEach(link => {
        const href = link.getAttribute('href');
        const nodeMatch = href?.match(/node=(\d+)/);
        if (nodeMatch) {
            lastNodeId = nodeMatch[1];
        }
    });

    if (lastNodeId !== '-1') {
        return lastNodeId;
    }

    // Method 2: Try to get from bestseller links in product details
    const rankCell = document.querySelector('td:has(span a[href*="/gp/bestsellers/"])');
    if (rankCell) {
        const categorySpans = rankCell.querySelectorAll('span:has(a[href*="/gp/bestsellers/"])');
        if (categorySpans.length > 0) {
            // Get the last category span (most specific)
            const lastSpan = categorySpans[categorySpans.length - 1];
            const categoryLink = lastSpan.querySelector('a');
            if (categoryLink) {
                const href = categoryLink.getAttribute('href');
                // Try different patterns for extracting category ID
                const patterns = [
                    /\/kitchen\/(\d+)\//, // matches /kitchen/289857/
                    /\/wireless\/(\d+)\//, // matches /wireless/12557637011/
                    /\/([^\/]+)\/(\d+)\//, // general pattern for any category
                ];

                for (const pattern of patterns) {
                    const match = href.match(pattern);
                    if (match) {
                        // If it's the general pattern, take the last group
                        const categoryId = match[match.length - 1];
                        return categoryId.replace('/ref=pd_zg_hrsr_kitchen', '');
                    }
                }
            }
        }
    }

    // Method 3: Try to get from zg_hrsr element
    const bestsellerElement = document.querySelector('.zg_hrsr');
    if (bestsellerElement) {
        const categoryLink = bestsellerElement.querySelector('a');
        if (categoryLink) {
            const href = categoryLink.getAttribute('href');
            const patterns = [
                /\/kitchen\/(\d+)\//, // matches /kitchen/289857/
                /\/wireless\/(\d+)\//, // matches /wireless/12557637011/
                /\/([^\/]+)\/(\d+)\//, // general pattern for any category
            ];

            for (const pattern of patterns) {
                const match = href.match(pattern);
                if (match) {
                    // If it's the general pattern, take the last group
                    const categoryId = match[match.length - 1];
                    return categoryId.replace('/ref=pd_zg_hrsr_kitchen', '');
                }
            }
        }
    }

    return '-1';
}
